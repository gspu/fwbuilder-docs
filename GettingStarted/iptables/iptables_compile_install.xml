<sect1 id="iptables_compile_install">
    <title>Compile and Install</title>

    <para>
    In Firewall Builder the process of converting the rules from the
    Firewall Builder GUI syntax to the target device commands is called
    <emphasis>compiling</emphasis> the configuration.
    </para>

    <para>
    To compile, click on the Compile icon which looks like a hammer
    <imagedata fileref="images/hammer_small.png" />. If you
    haven’t saved your configuration file yet you will be asked to do so. After
    you save your file a wizard will be displayed that lets you select which
    firewall(s) you want to compile. In this example we are going to complie
    the firewall called <emphasis>linux-1</emphasis> configured with the rules above.
    </para>

    <para>
    If there aren’t any errors, you should see some messages scroll by in the
    main window and a message at the top left stating Success.
    </para>

    <para>
    To view the output of the compile, click on the button that says Inspect
    Generated Files.  This will open the file that contains the script file 
    that Firewall Builder generates. The script file can be quite long, it 
    includes functions to update interface IP addresses, static routes, etc. 
    Near the bottom of the script you will find the section where the iptables 
    commands are generated. Note that any line that starts with “#” is a comment.
    </para>
        
  <figure id="iptables_compiler_output">
    <title>Example Compiler Output</title>      
    <graphic scale="50" fileref="images/iptables_compiler_output.png" />
  </figure> 
        
    <para>
    The output from the compiler is automatically saved in a file in the same
    directory as the data file that was used to create it. The generated files
    are named with the firewall name and a .fw extension. In our example the
    generated configuration file is called linux-1.fw. You could copy this 
    script file to the firewall, or you can use the built-in Firewall Builder 
    installer.
    </para>

    <bridgehead>Installing</bridgehead>

    <para>
    Firewall Builder can install the generated configuration file for you
    using SSH and SCP. To use the installer we need to identify one of the router
    interfaces as the “Management Interface”. This tells Firewall Builder
    which IP address to connect to on the router.
    </para>

    <para>
    Do this by double-clicking the firewall object to expand it, and then
    double-clicking on the interface name that you want to assign as the
    management interface. In this example this is interface eth1 
    which is the interface connected to the internal network.
    </para>

  <figure id="iptables_set_mgmt_interface">
    <title>Setting the Managment Interface</title>      
    <graphic scale="50" fileref="images/iptables_set_mgmt_interface.png" />
  </figure> 

  <note>
    <para>
    Any time you are changing access lists on your firewall you face the risk 
    of locking yourself out of the device. Please be careful to always inspect 
    your firewall rules closely and make sure that you will be able to access 
    the firewall after the iptables rules have been installed.
    </para>
  </note>

    <para>
    To install your access lists on the firewall, click on the install icon
    <imagedata fileref="images/install_icon.png" />. This will
    bring up a wizard where you will select the firewall to install. Click
    Next > to install the selected firewall.
    </para>

  <figure id="iptables_install_checkbox">
    <title>Setting Compile and Install Actions</title>      
    <graphic scale="50" fileref="images/iptables_install_checkbox.png" />
  </figure> 

    <para>
    Firewall Builder will compile your rules converting them in to
    iptables command format. After the compile completes successfully click 
    Next >. Enter your username and password.
    </para>

  <figure id="iptables_install_screen">
    <title>Install Dialog</title>      
    <graphic scale="50" fileref="images/iptables_install_screen.png" />
  </figure> 

    <para>
    After the access list configuration is installed you see a message
    at the bottom of the main window and the status indicator in the
    upper left corner of the wizard will indicate if the installation
    was successful.
    </para>
        
  <figure id="iptables_install_success">
    <title>Successful Install</title>      
    <graphic scale="50" fileref="images/iptables_install_success.png" />
  </figure> 
        
    <para>
    By default Firewall Builder will use SCP to copy the firewall script  
    file to the firewall. Once the script file is copied to the firewall, 
    Firewall Builder will connect using SSH to run the script.
    </para>

</sect1>

