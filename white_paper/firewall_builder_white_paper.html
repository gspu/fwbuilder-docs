

<h2>Introduction</h2>

<p>
  The leading cause of costly network downtime in the modern network
  operations organization of any size is human error. The probability
  of the error increases with the complexity of the configurations and
  as more devices from different vendors are added to the
  network. This applies to all components of the modern IP network,
  from server configurations, switches and routers, to the security
  related components as as firewalls. We are going to focus on the
  firewall configuration as one of the corner stones of the security
  policy implementation for an organization or a data center.
</p>

<p>
  Firewalls are well established mature components of the security
  policy implementations. Many vendors have been offering competing
  firewalls for many years, focusing on the performance and rich
  feature sets. The ease of configuration has always been secondary
  consideration and many firewalls are still being configured by hand
  from the command line or from rudimentary GUI that copies semantics
  of the underlying CLI. Checkpoint Firewall-1 has established itself
  as a leader in the GUI interface for firewalls and still is a
  trend-setter in the area. Now each vendor offers their own GUI to
  make managing their device easier, but they can not agree on the
  common model and as the result, all these management systems are
  different and complex in their own unique way.
</p>

<p>
  Open Source firewall implementations have gained momentum in the
  recent years and now offer viable alternative to the commercial
  systems. These implementations include iptables (netfilter) on
  Linux, pf on OpenBSD and FreeBSD, ipfilter and ipfw on FreeBSD.
  These systems provide very respectable feature set and good
  performance but only command line or plain text configuration files
  in the way of management. The syntax is often rather complex, very
  different between these implementations and definitely different
  from commercial firewalls. Administrator has to understand internal
  structure and logic of the given firewall system in order to be able
  to design and maintain its configuration with required level of
  confidence and reliability. Many firewall appliances based on
  iptables or pf offer web-based GUI interface that helps configure
  these, but still closely reflects the structure and ideas of the the
  underlying configuration language.
</p>


<h2>Complexity leads to errors</h2>

<p>
  When we talk about complexity of the configuration language, we mean
  not only CLI syntax and multitude of options, but also complexity of
  the internal logic of the firewall that administrator has to
  understand. For example, with iptables administrator must understand
  very clearly concepts of tables and chains and their relationship
  with the source and destination address of the packet, direction in
  which packet crosses the firewall and the operation that needs to be
  performed. The concept of chains is very powerful, it makes iptables
  configuration flexible, enables grouping of the rules, passing
  control from one group to another and so on. Administrator who
  understands these concepts can design policy that can deliver good
  performance and is relatively easy to maintain. But those who
  haven't mastered the concept get lost in the maize of tables and
  chains rather quickly. No wonder the poster-sized printout of the
  iptables packet flow diagram is usually pinned to the wall in the
  office of any iptables firewall administrator.
</p>

<p>
  Unfortunately, these great features are purely internal details of
  the iptables implementation and the knowledge gained in this area
  does not help administrator manage, say, Cisco ASA (PIX) or OpenBSD
  PF firewall.
</p>

<p>
  Another example is from the PIX. PIX uses three different types of
  commands to build Network Address Translation
  rules: <strong>global</strong> defines pool of addresses on the outside,
  <strong>nat</strong> defines translations for connections going from
  inside to targets outside of the firewall
  and <strong>static</strong> defines translations for the connections
  from outside to servers inside the firewall. Not only administrator
  has to always clearly remember which command to use for every
  translation they need to build, the syntax is rather
  complex. Command <strong>static</strong> requires two interfaces the
  packet has to cross on its way from the client to the server, so the
  administrator has to understand the routing through the firewall as
  well. They should remember which interface is "external" and which
  is "internal" and in what order they should be entered in the
  command. Situation becomes a lot more complex when firewall has many
  interfaces connected to different network segments. Cisco GUI used
  to configure PIX offers little to help automate configuration in
  this respect. Administrator using their GUI does not need to
  remember all possible options of all commands, as these are
  available in various menus and lists, but they still have to decide
  what command to use and which interfaces to put in it.
</p>

<p>
  Every firewall platform has its own set of complexities. Knowledge
  of these details separates experts in the field from those who only
  need to create minimal configurations or manage configurations
  written by others. Unfortunately, as organization grows and adds
  more services and network segments, sooner or later firewall
  configuration reaches the level where expert in the given platform
  becomes a necessity. As the result, network or security
  administrator spends a lot of time training themselves in the low
  level details of the firewall configuration instead of focusing on
  the security policy and its proper implementation.
</p>


<p>
  In the end, what is needed is a tool that could let administrator
  define security policy on a higher level of abstraction and hide
  internal structure of the target firewall platform. For example,
  such tool could decide which iptables chain is right for each
  generated iptables rule automatically, without administrator's
  input. It could also pick the right iptables targets for both
  policy and NAT (Network Address Translation) rules as well as
  properly use most popular iptables modules, all automatically.  The
  program could also generate correct PIX nat rules and pick
  interfaces automatically. Such tool should also implement best
  practices in policy design and help administrator deploy and
  activate generated policy on the firewall.
</p>




<h2>Multi-vendor environments multiply complexity</h2>


<p>
  Modern network almost always uses devices from different
  vendors. The reasons for this are many, from simple availability of
  the required features to budgeting considerations. "Security in
  depth" principles require security elements to be installed and
  activated on many different components on the network, including
  servers, routers and dedicated firewalls. This means security policy
  becomes distributed and its implementation requires coordinated
  changes in configurations of all these components.
</p>

<p>
  Unfortunately, target firewalls sometimes differ in the very
  fundamental principles of operation. This can make managing policies
  in the multi-vendor environment challenging because administrators
  have to break their habits while switching from one platform to
  another and back. This inevitably leads to human errors in the
  configurations they write and as a consequence, network outages. For
  example, many firewall platforms process rules top-down, with the
  first matching rule making decision and stopping processing. These
  are iptables, PIX, Cisco routers access lists.  However PF by
  default does it in the opposite way, with each matching rule not
  stopping processing and the last one making final decision. There is
  no "right" way of doing this and both approaches will do the right
  thing, provided configuration is written with understanding of how
  the firewall works. However, if an administrator is used to some
  method, it is hard to switch back and forth while managing different
  firewalls. Another example of similar discrepancy is the order in
  which access control and nat rules work on a packet. Iptables, PF
  and many others do nat first, so that access control rules "see"
  translated addresses in the packet. PIX, on the other hand, does it
  in the opposite order, with access control rules working on the
  packet before nat. This means access lists on PIX should be written
  in a different manner than, say, iptables rules for Linux or pf
  rules for OpenBSD firewalls.
</p>

<p>
  Network or security administrators in the large organization or a
  data center often have to make coordinated changes to iptables
  configurations on Linux servers, perhaps PF configurations on BSD
  servers, Cisco routers access lists and configurations of dedicated
  firewalls. Doing each one of these separately is not a trivial task
  in itself, but making changes across the whole system is a
  challenge. Now administrators need to modify configurations of
  several devices in entirely different languages, making sure all of
  them are coordinated and implement the same rules dictated by the
  overarching security policy. Complexity of each configuration
  change, multiplied by the number of devices and differences in their
  configuration languages leads to significant increase in the risk of
  error that can lead to downtime.
</p>



<h2>Solution</h2>

<p>
  If keeping many administrators on staff, each an expert in one or
  two firewall platforms, is not an option, then generation of the
  configuration must be automated. Humans should be involved on the
  high level where they operate with concepts that directly reflect
  network nodes, subnets, services and other entities and
  configuration management system should translate this into
  configuration files of firewalls they use. Firewall Builder by
  NetCitadel is the tool built for this purpose.
</p>

<p>
  One of the fundamental principles on which Firewall Builder is based
  is that it does not aim at just supporting one particular firewall
  platform. The goal is to be able to generate configuration for many
  different firewalls from the same representation in the GUI. To do
  this, Firewall Builder works with an abstract high level model of a
  firewall which incorporates features found in all target
  firewalls. In other words, Firewall Builder is not another iptables
  GUI, or PF GUI, or PIX GUI. Firewall Builder works with a firewall
  that is neither one of these, and yet at the same time it is all of
  them combined. It has useful features found in all of the target
  platforms. If a feature that it implements is not supported in some
  target firewall, it tries to emulate it (if possible) to make it
  look like the target really supports it.
</p>

<p>
  Since Firewall Builder works with an abstract firewall, all these
  discrepancies go away and administrator always sees consistent
  model regardless of the chosen target firewall platform. For PIX,
  the program can make it look like NAT is done after access control
  rules (but this is optional). For PF, the program always uses PF
  option that switches it to the non-default "first match" behavior.
  In the end, the program takes care of translating the firewall
  model it presents to the user into configuration of the actual
  target firewall.
</p>


<p>
  Policy and NAT rules built in Firewall Builder look very familiar to
  anyone who ever worked with Firewall-1, PIX, iptables, PF and so
  on. This is because these rules are just generalization of the ideas
  and features found in all of those firewalls. The GUI helps
  administrator create and manage rule sets and policy compilers then
  translate them into configuration language of the chosen target
  firewall platform.
</p>
