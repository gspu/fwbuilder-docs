<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Using Firewall Builder to Configure Cisco ASA & PIX</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

<style type="text/css">
<!--
.command {
    padding: 1em;
    border: 1px dashed #2f6fab;
    color: black;
    background-color: #f9f9f9;
    line-height: 1.1em;
        font-family: Courier New, Courier, mono;
        font-size: 12px;
        font-style: italic;
}

.system {
    color: black;
        font-family: Courier New, Courier, mono;
        font-size: 12px;
        font-style: italic;
}

.highlight {
    color: #FF0000;
  font-family: Georgia, "Times New Roman", Times, serif;
  font-size: 12px;
  text-decoration: underline;
}
-->
</style>
</head>
  <body>

            <h1>Using Firewall Builder to Configure Cisco ASA & PIX</h1>

            <img src="fwbuilder_logo.png" />
            <p>
            Author: Mike Horn &#60;mike [at] netcitadel [dot] com&#62;<br/>
            <a href="http://www.fwbuilder.com/?utm_source=web&utm_medium=howtoforge&utm_campaign=howto_cisco_asa">
            http://www.fwbuilder.org</a>
            </p>

            <p>
            Firewall Builder is a firewall configuration and management GUI 
            that supports configuring a wide range of firewalls from a 
            single application. Supported firewalls include Linux iptables, 
            BSD pf, Cisco ASA/PIX, Cisco router access lists and many
            more. The complete list of supported platforms along with
            downloadable binary packages and soure code can be found at 
            <a href="http://www.fwbuilder.com/?utm_source=web&utm_medium=howtoforge&utm_campaign=howto_cisco_asa">
            http://www.fwbuilder.org</a>.
            </p>
            
            <p>
            This tutorial is the second in a series of articles that
            walk through the basic steps of using Firewall Builder to
            configure each of the supported firewall platforms. In this 
            tutorial we will configure Access Control Lists (ACL) on a 
            Cisco ASA firewall.
            </p>

            <p>
            The diagram below shows a simple 2 interface firewall configuration
            based on a Cisco ASA 5505 with the firewall acting as a gateway to 
            the Internet for a private LAN network.
            </p>

            <center>
            <img src="example_asa.png" />
            </center>

            <p>
            We will use Firewall Builder to implement the following basic rules
            as access lists on the firewall.
            </p>

            <ul>
              <li>Allow inside traffic (10.0.0.0/24) through the firewall to any 
              Internet address for the <b>HTTP</b> and <b>HTTPS</b> protocols</li> 
              <li>Allow inside traffic from Email Server (10.0.0.25) through the 
              firewall to a specific IP address (198.51.100.25) for the <b>SMTP</b> 
              protocol. This external server is acting as an external mail relay.</li>
              <li>Allow inbound <b>SMTP</b> from external IP address (198.51.100.25) 
              to the internal Email Server (10.0.0.25).</li>
              <li>Allow inside traffic (10.0.0.0/24) to the firewall's inside 
              interface (Ethernet0/1) for the <b>SSH</b> protocol.</li>
            </ul>

            <p>
            Note that Cisco ASA and PIX access lists have an <b>implicit deny all</b> at 
            the end of every access list, so anything that we do not setup a rule to
            explicitly permit will be denied.
            </p>
    
            <p>
            We will also use Firewall Builder to implement the NAT configuration 
            on the firewall.
            </p>

            <ul>
              <li>Source NAT all inside traffic (10.0.0.0/24) through the firewall 
              destined to any Internet address changing the source IP to the IP 
              address of the outside interface (Ethernet0/0).</li>
              <li>Destination NAT traffic from external IP address (198.51.100.25), 
              the external SMTP relay server, coming to the outside interface with 
              TCP destination port of 25 (SMTP) and forward that to an internal 
              Email Server (10.0.0.25).</li> 
            </ul>

            <h3>NOTE</h3>

            <p>
            In this how to we use a ASA 5505 running ASA OS v8.3. Some of the 
            command syntax, especially for nat are different for earlier versions 
            of ASA OS, but you don't have to worry about this since Firewall 
            Builder automatically generates the right configuration commands based 
            on the version set for the firewall.
            </p>

            <h2>Step 1: Create Network Objects</h2>

            <p>
            We are going to start by creating the objects that will be used in
            the rules. Firewall Builder includes hundreds of predefined 
            objects, including most standard protocols, so to implement the
            rules above we will only need to create the objects that are 
            specific to our network. For our rules this means we need to
            create objects for the internal 10.0.0.0/24 network, for the internal 
            Email Server (10.0.0.25) and for the external SMTP relay server 
            with an IP address of 198.51.100.25.
            </p>

            <h3>Create a New IP Network Object</h3>

            <p>
            To create the object that will represent our internal 10.0.0.0/24 network 
            in the left hand tree double-click the folder labeled Objects to expand 
            it.  Right click on the folder called Networks and select &#34;New 
            Network&#34;. This creates a new network object. In the lower portion of 
            your screen, called the Editor Panel, you can modify the properties of 
            this object.
            </p>

            <p>
            Change the object name to something that matches the function, in this 
            example we are going to call it &#34;Internal Network&#34; to represent 
            the local LAN IP addresses. The address is set to 10.0.0.0 and the netmask 
            is 255.255.255.0.
            </p>

            <center>
            <img src="new_network.png" />
            </center>

            <p>
            <b>NOTE:</b> When editing the attributes of an object there is no Apply 
            or Submit button. Once you edit an attribute as soon as you move away from
            the field you were editing the change will take effect immediately.
            </p>

            <h3>Create a New IP Address Object</h3>

            <p>
            Repeat this process to create an object that will represent the SMTP
            Relay server that will be used in rule #2. Go to the object tree and 
            right-click on the Addresses folder and select New Address.  In the 
            Editor Panel change the name of the object to &#34;SMTP Relay&#34; 
            and set the IP address to 198.51.100.25.
            </p>

            <center>
            <img src="new_address_steps.png" />
            </center>

            <p>
            Repeat the steps above to create a new Address object to represent 
            the internal Email Server (10.0.0.25). After you are done you should 
            see two objects in the Addresses system folder in the object tree.
            </p>

            <center>
            <img src="address_objects.png" />
            </center>

            <h2>Step 2: Define The Firewall</h2>

            <p>
            To create a firewall object to represent your Cisco ASA click
            on the “Create new firewall” icon on the main window of
            Firewall Builder. This will launch a wizard that walks you through
            creating your firewall object.
            </p>

            <p>
            Enter a name for the firewall object, in this example we will use
            <b>asa-1</b>. Change the drop down menu for software that is running 
            on the firewall to be &#34;Cisco ASA (PIX)&#34;.  
            </p>

            <center>
            <img src="create_asa.png" />
            </center>

            <p>
            Click the <b>Next ></b> button to continue the wizard.
            </p>

            <p>
            When creating a firewall in Firewall Builder you have a choice of 
            configuring interfaces manually, or you can use SNMP discovery if you 
            have SNMP enabled on your router and you have access to a Read-Only or 
            Read-Write community string. For this example we are going to configure 
            the router interfaces manually.
            </p>
            
            <center>
            <img src="interface_discovery.png" />
            </center>
            
            <p>
            Click the <b>Next ></b> button to continue to the next step.
            </p>

            <p>
            The firewall that you create in Firewall Builder needs to match the
            Cisco ASA or PIX firewall that you want to deploy the access lists on.
            This means that the <b>interface names</b> and
            <b>IP addresses</b> in the firewall object that you are
            creating must <b>match exactly</b> to what is configured
            on the ASA or PIX.
            </p>

            <p>
            Click the green <img src="green_plus.png" />
            icon to add a new interface to the firewall.  Enter the name of the
            interface exactly as it is shown on the ASA or PIX command line when
            you run &#34;show interface&#34; command. In our example the interfaces are
            Ethernet0/0 through Ethernet0/7, but we are only going to use interfaces
            Ethernet0/0 and Ethernet0/1.
            </p>

            <p>
            Set the interface name as Ethernet0/0 and set the label to outside. Click 
            on the Add address button and set the IP address to 192.0.2.1 with a netmask
            of 255.255.255.240.
            </p>

            <center>
            <img src="asa_interface_address.png" />
            </center>
            
            <p>
            Click the green <img src="green_plus.png" />
            icon to add another interface to the firewall. Enter the information 
            in to the wizard to match the second interface as follows:
            </p>

            <center>
            <img src="asa_interface_address2.png" />
            </center>
            
            <p>
            Click on the <b>Next ></b> button.
            </p>

            <p>
            Firewall Builder will automatically set the <b>security 
            level</b> of the interface based on the interface label
            and IP address. The outside interface is set to security level
            0 and the inside interface is set to security level 100.
            </p>

            <center>
            <img src="asa_interface_sec_level.png" />
            </center>
            
            <p>
            Click on the <b>Finish</b> button to create the firewall object.
            </p>

            <p>
            After you create the firewall object representing the ASA or PIX
            the firewall object will be displayed in the object tree on the
            left side. The Policy object, which is where the access list rules
            are configured, is automatically opened in the main window.
            </p>

            <center>
            <img src="asa_firewall_object_tree.png" />
            </center>
           
            <p>
            Firewall Builder uses the concept of <b>Network Zones
            </b> to determine network topology in order to correctly
            create rules. Each firewall interface has a corresponding
            Network Zone that must be set. The Network Zone represents the
            set of IP networks that would be the source of traffic coming
            inbound to an interface.
            </p>

            <p>
            For example, if you use 10.0.0.0/8 for your internal network,
            the &#34;inside&#34; interface should have its Network Zone set to an
            object that represents 10.0.0.0/8. Network Zones can be a
            Network object or a group object that includes multiple Network
            objects. An exmple of when you would use a Group object is if
            your internal network used both 10.0.0.0/8 and 172.16.0.0/16.
            In this case you would create a Group object that included
            network objects for both these IP networks and use that Group
            object as your &#34;inside&#34; interface's Network Zone.
            </p>

            <p>
            For the &#34;outside&#34; interface you will typically set its
            Network Zone to &#34;Any&#34; which is all IP networks that aren't
            associated any other interfaces. Set the Network Zone by
            double-clicking the interface object of the firewall and
            selecting the Network Zone from the dropdown list.
            </p>

            <p>
            In this example we are going to set the Network Zone for the 
            Ethernet0/0 "outside" interface to "Any" and the Network Zone 
            for the Ethernet0/1 "inside" interface to "net-10.0.0.0" as 
            shown below.
            </p>

            <center>
            <img src="asa_setting_network_zone.png" />
            </center>

            <p>
            <b>NOTE: </b>The Network Zones used above are specifically for this 
            example. If you have different IP addresses and networks in use in 
            your network environment you may need to select different Network 
            Zone values.
            </p>

            <p>
            Now that the ASA firewall is ready for configuration, before moving 
            on we should save our data file that contains the new
            firewall object that we just created.  Do this by going to the
            File -> Save As menu item.  Choose a name and location to save this
            file to.
            </p>

  </body>
</html>
