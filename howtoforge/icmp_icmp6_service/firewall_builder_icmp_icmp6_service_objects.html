<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Firewall Builder: ICMP and ICMP6 Service Objects | HowtoForge - Linux Howtos and Tutorials</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<style type="text/css">
<!--
.command {
    padding: 1em;
    border: 1px dashed #2f6fab;
    color: black;
    background-color: #f9f9f9;
    line-height: 1.1em;
        font-family: Courier New, Courier, mono;
        font-size: 12px;
        font-style: italic;
}

.system {
    color: black;
        font-family: Courier New, Courier, mono;
        font-size: 12px;
        font-style: italic;
}

.highlight {
    color: #FF0000;
        font-family: Georgia, "Times New Roman", Times, serif;
        font-size: 12px;
        text-decoration: underline;
}
-->

</style>
</head>

<body>

  <h1>Using ICMP and ICMP6 Service Objects in Firewall Builder</h1>

  <table border=0>
    <tr>
      <td><img src="http://www.fwbuilder.org/images/icon_128x128.png" height="128" width="128" /></td>
      <td>Author: vadim@fwbuilder.org<br/>
        <a href="http://www.fwbuilder.org">http://www.fwbuilder.org</a>
      </td>
    </tr>
  </table>

  <p>
    This article continues the series of articles on Fireall Builder,
    a graphical firewall configuration and management tool that
    supports many Open Source firewall platforms as well as Cisco IOS
    access lists and Cisco ASA (PIX).  Firewall Builder was introduced
    on this site earlier with articles
    <a href="http://www.howtoforge.com/getting-started-with-firewall-builder">
    Getting Started With Firewall Builder</a>, 

    <a href="http://www.howtoforge.com/using-built-in-revision-control-in-firewall-builder">Using
    Built-In Revision Control In Firewall Builder</a>, 

    <a href="http://www.howtoforge.com/using-built-in-policy-installer-in-firewall-builder">
      Using Built-in Policy Installer in Firewall Builder</a>, 

    <a href="http://www.howtoforge.com/using-firewall-object-in-firewall-builder">
      Using Firewall Object In Firewall Builder</a>.

    This article demonstrates how you can work with <b>ICMP</b>
    and <b>ICMP6</b> service objects in Firewall Builder.
  </p>

  <p>
    More information on Firewall Builder, pre-built binary packages
    and source code, documentation and <b>Firewall Builder
    Cookbook</b> can be found on the project web site
    at <a href="http://www.fwbuilder.org">
    www.fwbuilder.org</a>. Watch <a href="http://blog.fwbuilder.org">Project
    Blog</a> for announcements and articles on all aspects of using
    Firewall Builder.
  </p>



	      <h1>Using ICMP and ICMP6 Service Objects in Firewall Builder</h1>

              <p>
                The ICMP Service object is a generalized
                representation of the ICMP protocol. ICMP packets
                are often used to communicate error messages that
                are acted upon by either the IP layer or higher
                layer protocols (TCP or UDP). ICMP can also be used
                as a simple query protocol.
              </p>

              <p>
                Firewall Builder has service objects for both IPv4
                and IPv6. ICMP Service objects for IPv6 are called
                ICMP6 Service. The standard ICMP Service objects
                that come with Firewall Builder appear in
                the <b>Standard Objects</b> library, in
                the <b>Services/ICMP</b> branch. User-defined ICMP
                and ICMP6 service objects will appear in the
                library <b>User</b> in the same <b>Services/ICMP</b>
                branch.
              </p>
                
              <p>
                Service objects in the Standard are not
                editable. However, you can copy-and-paste a copy of a
                service object into the User tree and edit it there,
                or you can right-click the ICMP folder in the User
                tree and select New ICMP Ser vice to create a service
                object from scratch.
              </p>

              
              <img src="icmp_service_tree.png"/>

              <p>
                As a firewall administrator, you need to understand
                the nature and purpose of ICMP in order to properly
                configure the firewall to block unwanted ICMP messages
                while permitting useful ones.
              </p>

              <p>
                ICMP packets have two header fields that distinguish
                particular ICMP messages: the type and code
                fields. There are many different types and classes of
                ICMP messages. See
                http://www.iana.org/assignments/icmp-parameters for
                IPv4 types and classes and
                http://www.iana.org/assignments/icmpv6-parameters
                (http://www.iana.org/assignments/icmpv6-parameters)
                for IPv6 types and classes. 
              </p>
              
              <p>
                Any combination of the <b>type</b> and <b>code</b>
                values is allowed in the ICMP or ICMP6 Object. For
                example the following two screenshots illustrate
                definitions of ICMP and ICMP6 objects for the
                request packet of well known ping protocol. The type
                codes are different for IPv4 and IPv6 variants,
                although the code is equal to 0 in both:
              </p>
              
              <img src="icmp_service_1.png"/>
              <br>
              <img src="icmp6_service_1.png"/>

              <p>
                Both ICMP and ICMP6 allow value "any" in type or
                code fields. For example, this can be used to build
                an object to match a family of ICMP messages with
                the same type but any code:
              </p>

              <img src="icmp_service_2.png"/>

              <p>
                Both IPv4 and IPv6 ICMP Service dialogs provide the
                following controls:
              </p>

              <ul>
                <li>Name: This is the name of the object. 
                </li>

                <li>ICMP Type and Code:
                  <ul>
                    <li>Type: The ICMP message type. This control
                      consists of a numeric selector that lets you
                      specify the message type. To specify "any" type,
                      set the control to any.
                    </li>

                    <li>Code: The ICMP message code. This control
                      consists of a numeric selector that lets you
                      specify the message code. To specify "any" code,
                      set the control to any.
                    </li>
                  </ul>
                </li>

                <li>Comment: This is a free-style text field used
                  for comments.
                </li>

              </ul>

              <h3>Using ICMP and ICMP6 Service Objects in Rules</h3>

              <p>
                Consider the following rule where we use two ICMP
                objects, one for IPv4 and another for IPv6:
              </p>

              <img src="icmp_service_rule_1.png"/>

              <p>
                If the rule set this rule belongs to is configured as
                combined IPv4 and IPv6, then policy compiler will pick
                ICMP service that matches address family on each
                separate pass, one for IPv4 and then for IPv6. Here is
                what we get for iptables:
              </p>

              <p class="command">
# ================ IPv4 <br>
 <br>
# Rule 0 (global) <br>
#  <br>
$IPTABLES -A FORWARD  -i + -p icmp  -m icmp  --icmp-type 8/0 \ <br>
     -m state --state NEW  -j ACCEPT  <br>
  <br>
# ================ IPv6 <br>
 <br>
# Rule 0 (global) <br>
#  <br>
$IP6TABLES -A FORWARD  -i + -p ipv6-icmp  -m icmp6 --icmpv6-type 128/0 \ <br>
     -m state --state NEW  -j ACCEPT  <br>
 <br>
              </p>

              <p>
                Here is generated PF 4.x configuration:
              </p>

              <p class="command">
 <br>
# Rule  0 (global) <br>
#  <br>
pass in   quick inet proto icmp  from any  to any icmp-type 8 code 0 <br>
 <br>
# Rule  0 (global) <br>
#  <br>
pass in   quick inet6 proto icmp6  from any  to any <br>
 <br>
              </p>

</body>
</html>

