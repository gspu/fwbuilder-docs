<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Using Firewall Builder to Configure Router Access Lists</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

<style type="text/css">
<!--
.command {
    padding: 1em;
    border: 1px dashed #2f6fab;
    color: black;
    background-color: #f9f9f9;
    line-height: 1.1em;
        font-family: Courier New, Courier, mono;
        font-size: 12px;
        font-style: italic;
}

.system {
    color: black;
        font-family: Courier New, Courier, mono;
        font-size: 12px;
        font-style: italic;
}

.highlight {
    color: #FF0000;
  font-family: Georgia, "Times New Roman", Times, serif;
  font-size: 12px;
  text-decoration: underline;
}
-->
</style>
</head>
<body>
            <h2>Getting Started: Configuring Cisco Router ACL</h2>

            <p>
            <b>Reminder</b> - In this tutorial we are configuring access lists 
            on a router that has the following interface configuration.
            </p>

            <center>
            <img src="example_router.png" />
            </center>

            <p>
            Our goal is to implement the following four rules as access control
            lists on the router.
            </p>
            <ul>
              <li>Allow inside traffic (10.0.0.0/24) through the router to any 
              Internet address for the <b>HTTP</b> and <b>HTTPS</b> protocols </li>
              <li>Allow inside traffic (10.0.0.0/24) through the router to a specific
              IP address (198.51.100.1) for the <b>POP3</b> protocol.</li>
              <li>Allow inside traffic (10.0.0.0/24) to the router&#39;s inside 
              interface (FastEthernet0/1) for the <b>SSH</b> protocol.</li>
              <li>Block all incoming traffic to the router&#39;s outside interface
              (FastEthernet0/0).</li>
            </ul>

            <h2>Step 3: Configure Access Lists</h2>

            <p>
            After we created the firewall object <b>la-rtr-1</b> it was automatically
            opened in the object tree and its Policy object was opened in the main 
            window for editing. The Policy object is where access list rules are
            configured.
            </p>

            <p>
            To add a new rule to the Policy, click on the green 
            <img src="green_plus.png" /> icon at the top
            left of the main window. This creates a new rule with default values set 
            to deny all.
            </p>

            <center>
            <img src="default_rule.png" />
            </center>

            <p>
            In Firewall Builder everything is based on the concept of <b>objects</b>.
            To configure rules that will be converted in to access lists you simply
            find the object you want in the tree and drag-and-drop it to the correct 
            section of the rule.
            </p>

            <p>
            The first rule in our example is to allow internal network traffic to use 
            the HTTP and HTTPS protocols to access the Internet. In configuration  
            the router is NAT'ing the internal network to the IP address on the 
            FastEthernet interface. Since the order of operations on Cisco routers
            is that NAT takes place <b>before</b> the outbound access list is checked 
            the Source for the outbound rules must be the post-NAT IP address which
            is represented by the IP interface object under the outside FastEthernet0/0 
            interface.
            </p>

            <center>
            <img src="new_rule_source.png" />
            </center>

            <p>
            After you drop the interface IP object into the rule the Source section will
            change from Any to la-rtr-1:FastEthernet0/0:ip.  
            </p>
            
            <center>
            <img src="rule_step1.png" />
            </center>
           
            <p> 
            Since we want this rule to allow traffic to the Internet we will leave
            the Destination object set to Any. The Any object in Firewall Builder
            is the same as the "any" parameter in Cisco CLI commands for access 
            lists.
            </p>
            
            <p>
            Next we want to define the protocols or services this rule will allow. 
            The example calls for the HTTP and HTTPS services to be allowed out
            to the Internet.
            </p>
            
            <p>
            Firewall Builder comes with hundreds of <b>predefined</b> objects including 
            almost all standard protocols. To access these objects switch to the 
            Standard library by selecting it from the drop down at the top of the 
            Object tree window.
            </p>
            
            <center>
            <img src="switch_library.png" />
            </center>
            
           <p> 
            After you have switched to the Standard library you can navigate to 
            the HTTP service by opening the Services folder, then opening the TCP 
            folder and scrolling down until you find the http object.
            </p>

            <p>
            Once you find the http object, drag-and-drop from the tree on the left in 
            to the Service section of the rule in the Rules window.
            </p>

            <center>
            <img src="new_rule_service.png" />
            </center>
           
            <p>
            Repeat this process to add the HTTPS service to the rule. Drag-and-drop 
            the <b>https</b> object from the tree on the left to the Service section 
            of the rule in the Rules window.
            </p>

            <p>
            <b>NOTE:</b> Notice that you can have more than one service in a single rule.
            Firewall Builder will automatically expand this rule in to multiple rules
            in the Cisco command syntax.
            </p>

            <p>
            <b>IMPORTANT!</b> To access the objects you previously created, including 
            the router, you need to switch back to the <b>User library</b>. Do this by 
            going to the drop down menu at the top of the object tree panel and switch 
            the selected library from Standard to User.
            </p>

            <p>
            Due to the NAT configuration that is setup on the router traffic from the 
            10.0.0.0/24 network will be NAT'ed by the router to its outside IP address 
            (192.0.2.1).  This means the traffic that we want to match with our rule
            will be sent out the FastEthernet0/0 interface. Set the interface in the 
            rule by dragging-and-dropping the FastEthernet0/0 interface object from 
            the tree to the Interface section of the rule.
            </p>
            
            <center>
            <img src="new_rule_interface.png" />
            </center>

            <p>
            Traffic will be going in the outbound direction on this interface, so
            we right-click in the Direction section and select Outbound. We want this
            traffic to be allowed, so we need to change the Action associated with this 
            rule from Deny to Accept. Do this by right-clicking on the Action section 
            of the rule an selecting Accept. Finally, since this is a rule that we 
            expect to match a lot of traffic disable logging by right-clicking in the 
            Options section and selecting Logging Off. You should now see a rule 
            that looks like:
            </p>

            <center>
            <img src="new_rule_complete.png" />
            </center>

            <p>
            The next rule in our example allows the internal network to access an 
            external POP3 server. Click on the rule you just created and then 
            right-click in the rule number section and select &#34;Add New Rule Below&#34;.  
            </p>
            
            <center>
            <img src="add_new_rule_below.png" />
            </center>

            <p>
            To access the objects that we created earlier we need to switch back to the 
            User library. Click on the drop down menu that says Standard and select User 
            from the list. Drag-and-drop the IP address object for the router&#39;s outside
            inteface from the tree on the left to the rule you just created placing it 
            in the Source section.
            </p>

            <p>
            <b>NOTE:</b> You can also copy-and-paste objects.  For example, you can
            right-click on the la-rtr-01:FastEthernet0/0:ip object in the first rule 
            and select Copy. Navigate to the Source section of the new rule you just 
            created and right-click and select Paste.
            </p>

            <p>
            This rule requires both the Source and Destination to be set, so go to the 
            Addresses folder and drag-and-drop the POP3 Server object to the Destination 
            section of the rule.
            </p>

            <p>
            The POP3 protocol object is located in the Standard library, so select it 
            from the dropdown menu at the top of the Object Window. To find the POP3 
            object you can scroll down through the object tree, or you can simply type 
            pop3 in to the filter field. This will display all objects in the current
            library that contain pop3.
            </p>

            <center>
            <img src="pop3_filter.png" />
            </center>

            <p>
            Drag-and-drop the filtered object from the tree to the Sevice section of 
            the rule you are currently editing. Clear the filter field by clicking the 
            X to the right of the input box and then switch back to the User library by 
            selecting it in the dropdown menu at the top of the object panel.
            </p>

            <p>
            To set the interface the rule should be applied to drag-and-drop the 
            &#34;outside&#34; interface FastEthernet0/0 to the Interface section of 
            the rule.
            </p>
           
            <p>
            To change the Action to Accept right-click in the Action section of the
            rule and select Accept. To disable logging for this rule, right-click on
            the Options section and select Logging Off.
            </p>

            <p>
            You should now have 2 rules that look like this:
            </p>

            <center>
            <img src="two_rules.png" />
            </center>
           
            <p>
            Now we need to add our 3rd rule.  This rule is designed to allow 
            SSH traffic from the internal network to the router’s inside interface. 
            </p>

            <p>
            Create a new rule below the last rule by selecting the last rule and 
            right-clicking and selecting Add New Rule Below from the menu. This will 
            create a new rule configured with the default values to deny all.
            </p>
            
            <p>
            Modify this rule by dragging-and-dropping the <b>Internal Network</b> 
            object from the tree to the Source section of the newly created rule. 
            To restrict the rule to only allow traffic destined to the IP address 
            of the router&#39;s FastEthernet1/0 interface, double-click on the
            firewall object's FastEthernet1/0 interface to expand it.  Drag-and-
            drop the IP address of the interface to the Destination section of
            the rule.
            </p>

            <p>
            To set the service to SSH switch to the Standard library by selecting 
            it from the dropdown menu above the object tree and then type in 
            &#34;ssh&#34; in the filter box. Drag-and-drop the <b>ssh</b> object from 
            the tree to the Service section. Clear the filter by clicking on the X 
            next to the filter input text box.
            </p>  

            <p> 
            Switch back to the User library by selecting it from the dropdown menu
            above the object tree. Double click the <b>la-rtr-1</b> object to expand 
            it and drag-and-drop the FastEthernet1/0 interface to the Interface 
            section of the rule. 
            </p>
            
            <p> 
            Since this rule only applies to inbound traffic on this interface set 
            the direction to Inbound by right-clicking in the Direction section and
            selecting Inbound. Finally, change the action for the rule by right-
            clicking on the Action section and selecting Accept. Since this rule
            defines access to the router via SSH we will leave logging enabled for
            this rule.
            </p>

            <p>
            You should now have 3 rules that look like:
            </p>

            <center>
            <img src="three_rules.png" />
            </center>

            <p>
            Since we added a rule that will create an inbound access list on the
            inside FastEthernet0/1 interface, we need to add rules that allow
            the traffic for the first two rules inbound on inside interface.
            Otherwise this traffic would be blocked coming in to the router and
            it would never reach the outbound access list on the outside
            interface. Follow the same steps from above, but set the interface to
            the inside FastEthernet0/1 interface and set the Direction as
            Inbound.
            </p>

            <p>
            Your rules should now look like this:
            </p>

            <center>
            <img src="five_rules.png" />
            </center>

            <p>
            Finally, we need to add a rule to the router&#39;s outside interface that 
            blocks all traffic trying to access the router directly on its outside
            interface IP address.
            </p>

            <p>
            To do this we follow the same process from the earlier examples. Since 
            this rule should match all traffic coming from the Internet we leave the
            Source section as Any. Set the Destination section by dragging-and-dropping
            the IP address object for outside interface FastEthernet0/0. We want to
            block all serices, so leave the Service section set to Any.  We want this
            rule to match incoming traffic, so we right-click in the Direction section
            and select Inbound.  The desired Action is to deny the traffic, so we 
            leave that as the default.  Finally since this rule will potentially match
            a lot of traffic we disable logging by right-clicking on the Options 
            section and selecting Logging Off.
            </p>

            <p>
            We are now done configuring the rules for our access lists and the
            configuration should look like:
            </p>

            <center>
            <img src="six_rules.png" />
            </center>

            <p>
            In the next section we will go through the process of converting these
            rules in to Cisco commands and installing them on the router.
            </p>
  </body>
</html>
