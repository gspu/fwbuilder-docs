<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Importing iptables configurations into Firewall Builder</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

<style type="text/css">
<!--
.command {
    padding: 1em;
    border: 1px dashed #2f6fab;
    color: black;
    background-color: #f9f9f9;
    line-height: 1.1em;
        font-family: Courier New, Courier, mono;
        font-size: 12px;
        font-style: italic;
}

.system {
    color: black;
        font-family: Courier New, Courier, mono;
        font-size: 12px;
        font-style: italic;
}

.highlight {
    color: #FF0000;
  font-family: Georgia, "Times New Roman", Times, serif;
  font-size: 12px;
  text-decoration: underline;
}
-->
</style>
</head>
  <body>

    <h2>Importing iptables configurations into Firewall Builder</h2>

        <p>
          After the import is completed, the newly created firewall object will be 
          displayed in the object tree. If you expand the Objects system folder, as 
          shown in <xref linkend="iptables-import-object-tree-1" />, you can also see 
          the Address and Network objects that were created during the import process.
        </p>
        
          <img src="iptables_import_object_tree.png"/>

        <p>
          After the firewall object is created in the object tree there are typically 
          a few more steps required in order to be able to manage your firewall 
          configuration using Firewall Builder.
        </p>

        <h3>Interfaces</h3>
         
        <p>
          There is not enough information in the iptables configuration for Firewall 
          Builder to deterministically determine what interfaces and IP addresses are 
          configured on the firewall. During the import if a rule contains either "-i" 
          or "-o" interface references Firewall Builder will add the interface to the 
          firewall object, but some interfaces may not be used in rules and therefore 
          will not be detected.
        </p>

        <p>
          In the example configuration that was imported for linux-1, both the eth0 and 
          eth1 interfaces were used in the configuration, so the firewall object includes 
          these interfaces. By default Firewall Builder marks these interfaces as 
          Unnumbered.
        </p>
        
        <p>
          To update the eth0 interface, double-click it to open it for editing. 
          The figure below shows how to set a label for the interface and to identify 
          that it should have a static IP address.
        </p>

        <img src="iptables_import_edit_interface_params.png"/>

        <p>
          To add an IP address to the eth0 interface, right-click on the interface 
          in the object tree and select New Address to add an IP address to the 
          interface as shown in the figure below. Set the IP address and netmask 
          to match your environment.
        </p>

        <img src="iptables_import_edit_interface_params-2.png"/>

        <p>
          You may also need to add additional interfaces to the firewall object depending 
          on what Firewall Builder was able to detect from the iptables rules. To add a 
          new interface right-click the firewall object (in our example linux-1) and 
          select New Interface. Add the interface name and label and set the type if 
          necessary. The default type is Static IP address.
        </p>

        <p>
        Just like in the previous example, to add a new IP address to any interfaces that 
        you configure right-click on the interface in the object tree and select New 
        Address.
        </p>

        <h3>Rules</h3>

        <p>
          During the import of the linux-1.conf file. Firewall Builder displayed a 
          warning message that there were rules defined to allow RELATED and ESTABLISHED 
          traffic to the firewall. Instead of having to explicitly have a rule for 
          this, Firewall Builder has a configuration option controlling this behavior.
        </p>

        <p>
          To view the configuration option controlling RELATED and ESTABLISHED traffic 
          double-click on the firewall object and click on the Firewall Settings button 
          in the Editor Panel. The dialog window will open with the Compiler tab selected. 
          About halfway down the window is the checkbox that controls RELATED and 
          ESTABLISHED traffic, which is enabled by default.
        </p>

        <img src="iptables_import_options.png"/>

        <p>
          By default Firewall Builder is set to allow RELATED and ESTABLISHED traffic, so 
          the imported rules 0 and 2 are not necessary. To remove these rules right-click the rule 
          number and select Remove Rule as shown in the diagram below. 
        </p>

        <img src="iptables_import_remove_rule.png"/>

        <p>
          The specific rule numbers will vary based on your configuration, but the rules 
          created for matching RELATED and ESTABLISHED traffic are identifiable by the use 
          of the predefined ESTABLISHED objct in the Service field of the rule.
        </p>

        <h3>NAT rules</h3>

        <p>
          To view the imported NAT rules, double-click the NAT object under the linux-1 
          object in the tree. In this example, there is a single source NAT rule that translates 
          inside addresses to the eth0 (outside) interface of the firewall.
        </p>

        <img src="iptables_import_nat_rules.png"/>

        <p>
        Since this matches what we want, there is nothing to change in the NAT rules.
        </p>

        <h3>User-Defined Chains</h3>
        
        <p>
          If your iptables configuration includes user-defined chains, Firewall Builder will 
          create a new Policy object for each user chain and will use the Branch feature to 
          jump from the main Policy to the user chain Policy. In our example linux-1.conf 
          configuration there is a user chain called LOGDROP that has 2 rules. The first 
          rule logs the packet and the second rule drops it.
        </p>

        <p>
          To view the rules in the LOGDROP policy, double-click the LOGDROP policy object 
          located under the linux-1 firewall object. This will open the rules in the Rules 
          Editor as shown in the figure below. 
        </p>

        <img src="iptables_import_logdrop_rules.png"/>
        
        <p>
        Depending on your configuration you may be able to move some of the rules from 
        a user defined chain Policy to the main Policy object.
        </p>

        <p>
        Your firewall is now ready to be edited and maintained using Firewall Builder.
        </p>

</body>
</html>
