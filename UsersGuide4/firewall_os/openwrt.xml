  <sect1 id="openwrt">
    <title>OpenWRT</title>

    <para>
      To use Firewall Builder
      with <ulink url="http://openwrt.org/">OpenWRT</ulink> you need
      to install the following packages on the firewall, using the 
      <command>"ipkg install package.ipk"</command> command:
    </para>

    <itemizedlist>
      <listitem> <para> ip </para> </listitem>

      <listitem> <para> ip6tables (if you need IPv6) </para> </listitem>

      <listitem> <para> iptables-mod-extra </para> </listitem>

      <listitem> <para> iptables-utils </para> </listitem>

      <listitem> <para> kmod-ipt-extra </para> </listitem>
    </itemizedlist>

    <note>
      <para>
        The firewall script generated by Firewall Builder for OpenWRT has a format
        that allows it to be placed directly in
        the <emphasis>/etc/init.d/</emphasis> directory among other
        OpenWRT startup scripts. Its default name, however, is
        different from the name of the OpenWRT standard firewall
        script (which is <emphasis>"firewall"</emphasis>). The script
        generated by Firewall Builder has
        name <emphasis>"firewall.fw"</emphasis> by default so it does
        not overwrite the standard
        script <emphasis>"firewall"</emphasis>. This is done as a
        precaution, since support for OpenWRT was only added in
        Firewall Builder v4.0 and we haven't accumulated enough
        experience with it. If you feel it works well and can be used
        as a replacement for the standard firewall script, just change
        the name of the script to <emphasis>"firewall"</emphasis> in
        the "Compiler" tab of the firewall settings
        dialog. Instructions in this section explain how to activate
        the script generated by Firewall Builder, assuming it has the default
        name <emphasis>"firewall.fw"</emphasis>. This way, the
        standard script is still going to be present on the firewall
        and you can always switch back to it.
      </para>
    </note>

    <para>
      Firewall Builder uses name <emphasis>"fwbuilder.fw"</emphasis>
      for the generated script for OpenWRT and places it in directory
      <emphasis>"/etc/init.d/"</emphasis> on the firewall. To make the
      firewall run it during boot sequence, install the script using the 
      built-in policy installer or copy it to this directory manually,
      then run the command
    </para>

    <programlisting>
/etc/init.d/fwbuilder.fw enable
    </programlisting>

    <para>
      and disable the standard firewall script:
    </para>

    <programlisting>
/etc/init.d/firewall disable
    </programlisting>

    <para>
      To activate the firewall and load policy generated by Firewall Builder,
      use command
    </para>

    <programlisting>
/etc/init.d/fwbuilder.fw start
    </programlisting>

    <para>
      To stop the firewall and block all traffic use the command
    </para>

    <programlisting>
/etc/init.d/fwbuilder.fw stop
    </programlisting>

    <para>
      An option in the "Compiler" tab of the firewall object in
      Firewall Builder GUI allows you to make the firewall block all traffic
      when stopped but still permit ssh connections from preconfigured
      address of the management machine.  This method works both on
      stable Kamikaze (v7.06) and the latest OpenWRT (v8.09 at the
      time of Firewall Builder v4.0 release).
    </para>

    <para>
      In test mode Firewall Builder copies generated firewall script to
      directory <emphasis>/tmp</emphasis> on the firewall.
    </para>
  </sect1>

