    <sect1 id="running_firewall_script">
      <title>Running the Firewall Script</title>
      <sect2 id="troubleshooting-which-rule">
        <title>Determining which rule caused an error</title>

        <para>
        <emphasis>I get an error when I run the generated script. How can I figure out 
        which rule causes this error?</emphasis></para>

        <para>You can turn debugging on (look for a checkbox in the tab "Firewall" in 
        firewall dialog). This simple generates firewall script with shell option "-x" 
        so it will print all commands while executing. This way you can see which command 
        causes the error and trace it back to the policy rule.</para>
      </sect2>
      <sect2 id="ip-command-not-found">
        <title>"ip: command not found"</title>

        <para><emphasis> (Linux / iptables only) I've generated script for iptables firewall 
        using Firewall Builder, but when I run it I get an error "ip: command not found". 
        What is this command for and what package should I install?</emphasis></para>

        <para>This tool is part of the package 'iproute'; we use it to manage virtual IP addresses 
        needed for some NAT rules.</para>
      </sect2>
      <sect2 id="cant-initialize-table-drop">
        <title> I get the following error when I run generated script for iptables firewall: 
        "iptables v1.2.8: can't initialize iptables table 'drop': Table does not exits (do 
        you need to insmod?) Perhaps iptables or your kernel needs to be upgraded."</title>

        <para>You get this error because you used the option "Log all dropped packets" 
        (there is a checkbox in the 'Firewall' tab). This option requires the "dropped" 
        patch from patch-o-matic. You either need to turn this option off, or apply the 
        corresponding patch and recompile both kernel modules and command-line utilities 
        for iptables.</para>
      </sect2>
      <sect2 id="interface-does-not-exist">
        <title>"Interface eth0 does not exist"</title>

              <para>
              <emphasis>You are trying to execute an iptables script generated by Firewall 
              Builder but get an error message "Interface eth0 does not exist" or similar.
              </emphasis></para>

        <para>There are several conditions that may cause this error.</para>

              <para>The script generated by Firewall Builder uses the tool /sbin/ip to 
              verify configuration of the firewall interfaces and make sure that interfaces 
              of the real firewall machine correspond to the interface objects created in 
              the GUI. You may get this error if the tool /sbin/ip is not installed on 
              your system. All modern Linux distributions come with the package iproute2 
              which includes /sbin/ip; check if iproute2 is installed and /sbin/ip exists.
              </para>

        <para>Another case when you may encounter this error is when firewall script is 
        executed prematurely during the boot sequence and interface really does not exist 
        at that time. For example, interface ppp0 is created only when the system is 
        configured for PPP and the daemon pppd is running. If the firewall script is 
        activated before the daemon started during the boot sequence, interface ppp0 is 
        not there yet, which leads to this error. Make sure you start firewall script after 
        all interfaces has been initialized.</para>
      </sect2>
      <sect2 id="interface-does-not-exist-2">
        <title>"Interface eth0:1 does not exist"</title>

        <para>
        <emphasis>My firewall has virtual interface eth0:1. In fwbuilder I added 
        the interface, however, when I want to apply the new rules I get the error 
        "Interface eth0:1 does not exist"</emphasis>
        </para>

        <para>eth0:1 is not a real interface on Linux, it is just a label for a 
        second IP address of the interface eth0. One way to solve this is not to 
        create it in the OS (remove file /etc/sysconfig/network-scripts/ifcfg-eth0:1 
        and restart networking), but rather add its IP address in the Firewall Builder 
        GUI as a second address to interface eth0.</para>

        <para>
        In any case you should not add interface "eth0:1" in fwbuilder because it 
        really does not exist. Iptables will not recognize this interface either, 
        so even if Firewall Builder did allow you to use it, you would get an error 
        from iptables. You see "eth0:1" in the output of ifconfig only because 
        ifconfig has been modified on Linux to show virtual IP addresses as 
        pseudo-interfaces. The command "ip addr show" will reveal that the eth0:1 is 
        really a label on the second IP address of eth0.</para>
      </sect2>
      <sect2 id="script-fails-to-load-nf_conntrack">
        <title>Script fails to load module nf_conntrack</title>

        <para>
        <emphasis>Generated script fails to load module nf_conntrack when it is executed 
        on the firewall</emphasis></para>
        <para>This problem is specific to iptables. The answer below has been written in 
        September 2006, most likely the situation and relevant recommendations will change 
        as the module nf_conntrack matures and gets wider deployment.</para>

        <para>Here is an example of an error message:</para>
        <programlisting>
FATAL: Error inserting nf_conntrack_ipv4
(/lib/modules/2.6.13-15.11-default/kernel/net/ipv4/netfilter/nf_conntrack_ipv4.ko):
Device or resource busy
        </programlisting>

        <para>Here is the 
        <ulink url="http://www.netfilter.org/projects/patch-o-matic/pom-extra.html#pom-extra-nf_conntrack"><citetitle>link</citetitle></ulink> to the nf_conntrack page in patch-o-matic catalog. Here is the <ulink url="http://lists.netfilter.org/piperma
il/netfilter-devel/2006-July/024879.html"><citetitle>link</citetitle></ulink> to the discussion on netfilter-devel mailing list.</para>

        <para>It appears you can load either ip_conntrack or nf_conntrack but not 
        both at the same time since nf_conntrack is a replacement for ip_conntrack. 
        As of this writing, nf_conntrack does not support NAT just yet and is marked 
        as having status "TESTING" on the patch-o-matic catalog page.</para>

        <para>This actually represents a problem for fwbuilder. I would like to avoid 
        having to write extensive GUI to let user choose which modules they want to 
        load. One of the reasons is that the GUI may be working on one machine, while 
        generated firewall script will be executed on another. In this situation the 
        GUI cannot determine which modules are available on the firewall. Currently 
        generated script simply tries to load all modules but it aborts if it detects 
        an error in the command that does it (modprobe).</para>

        <para>Until a better solution is found, you would probably need to remove the 
        module that conflicts with others or disable the feature that makes the generated 
        script load modules and write your own script to load modules you need. You can 
        for example add commands to load modules explicitly to the "prolog" section of 
        the generated script.</para>
      </sect2>
    </sect1>

