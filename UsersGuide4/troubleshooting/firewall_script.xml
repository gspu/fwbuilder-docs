    <sect1 id="running_firewall_script">
      <title>Running the Firewall Script</title>
      <sect2>
        <title>Determining which rule caused an error</title>

        <para><emphasis>I get some error when I run generated script, how can I figure out which rule causes this error?</emphasis></para>

        <para>You can turn debugging on (look for a checkbox in the tab "Firewall" in firewall dialog). This simple generates firewall 
script with shell option "-x" so it will print all commands while executing. This way you can see which command causes the error and tr
ace it back to the policy rule.</para>
      </sect2>
      <sect2>
        <title>"ip: command not found"</title>

        <para><emphasis> (Linux / iptables only) I've generated script for iptables firewall using Firewall Builder, but when I run it 
I get an error "ip: command not found". What is this command for and what package should I install?</emphasis></para>

        <para>This tool is part of the package 'iproute'; we use it to manage virtual IP addresses needed for some NAT rules.</para>
      </sect2>
      <sect2>
        <title> I get the following error when I run generated script for iptables firewall: "iptables v1.2.8: can't initialize iptable
s table 'drop': Table does not exits (do you need to insmod?) Perhaps iptables or your kernel needs to be upgraded."</title>

        <para>You get this error because you used option "Log all dropped packets" (there is a checkbox in the 'Firewall' tab). This op
tion requires "dropped" patch from patch-o-matic. You either need to turn this option off, or apply corresponding patch and recompile b
oth kernel modules and command-line utilities for iptables.</para>
      </sect2>
      <sect2>
        <title>"Interface eth0 does not exist"</title>

        <para><emphasis>You are trying to execute iptables script generated by fwbuilder but get an error message "Interface eth0 does 
not exist" or similar.</emphasis></para>

        <para>There are several conditions that may cause this error.</para>

        <para>The script generated by fwbuilder uses tool /sbin/ip to verify configuration of the firewall interfaces and make sure tha
t interfaces of the real firewall machine correspond to the interface objects created in the GUI. You may get this error if the tool /s
bin/ip is not installed on your system. All modern Linux distributions come with the package iproute2 which includes /sbin/ip; check if
 iproute2 is installed and /sbin/ip exists.</para>

        <para>Another case when you may encounter this error is when firewall script is executed prematurely during the boot sequence a
nd interface really does not exist at that time. For example, interface ppp0 is created only when the system is configured for PPP and 
daemon pppd is running. If firewall script is activated before the daemon started during the boot sequence, interface ppp0 is not there
 yet, which leads to this error. Make sure you start firewall script after all interfaces has been initialized.</para>
      </sect2>
      <sect2>
        <title>"Interface eth0:1 does not exist"</title>

        <para><emphasis>My firewall has virtual interface eth0:1. In fwbuilder I added the interface, however, when I want to apply the
 new rules I get the error "Interface eth0:1 does not exist"</emphasis></para>

        <para>eth0:1 is not a real interface on Linux, it is just a label for a second IP address of the interface eth0. One way to sol
ve this is not to create it in the OS (remove file /etc/sysconfig/network-scripts/ifcfg-eth0:1 and restart networking), but rather add 
its IP address in the Firewall Builder GUI as a second address to interface eth0.</para>

        <para>In any case you should not add interface "eth0:1" in fwbuilder because it really does not exist. Iptables will not recogn
ize this interface either, so even if fwbuilder let you use it, you would get an error from iptables. You see "eth0:1" in the output of
 ifconfig only because ifconfig has been modified on Linux to show virtual IP addresses as pseudo-interfaces. The command "ip addr show
" will reveal that the eth0:1 is really a label on the second IP address of eth0.</para>
      </sect2>
      <sect2>
        <title>Script fails to load module nf_conntrack</title>

        <para><emphasis>Generated script fails to load module nf_conntrack when it is executed on the firewall</emphasis></para>
        <para>This problem is specific to iptables. The answer below has been written in September 2006, most likely the situation and 
relevant recommendations are going to change in the future as module nf_conntrack matures and gets wider deployment.</para>

        <para>Here is an example of an error message:</para>
        <programlisting>
FATAL: Error inserting nf_conntrack_ipv4
(/lib/modules/2.6.13-15.11-default/kernel/net/ipv4/netfilter/nf_conntrack_ipv4.ko):
Device or resource busy
        </programlisting>

        <para>Here is the <ulink url="http://www.netfilter.org/projects/patch-o-matic/pom-extra.html#pom-extra-nf_conntrack"><citetitle
>link</citetitle></ulink> to the nf_conntrack page in patch-o-matic catalog. Here is the <ulink url="http://lists.netfilter.org/piperma
il/netfilter-devel/2006-July/024879.html"><citetitle>link</citetitle></ulink> to the discussion on netfilter-devel mailing list.</para>

        <para>It appears you can load either ip_conntrack or nf_conntrack but not both at the same time since nf_conntrack is a replace
ment for ip_conntrack. As of this writing, nf_conntrack does not support NAT just yet and is marked as having status "TESTING" on the p
atch-o-matic catalog page.</para>

        <para>This actually represent a problem for fwbuilder. I would like to avoid having to write extensive GUI to let user choose w
hich modules they want to load. One of the reasons is that the GUI may be working on one machine, while generated firewall script will 
be executed on another. In this situation the GUI cannot determine which modules are available on the firewall. Currently generated scr
ipt simply tries to load all modules but it aborts if it detects an error in the command that does it (modprobe).</para>

        <para>Until better solution is found, you would probably need to remove module that conflicts with others or disable feature th
at makes generated script load modules and write your own script to load modules you need. You can for example add commands to load mod
ules explicitly to the "prolog" section of the generated script.</para>
      </sect2>
    </sect1>

