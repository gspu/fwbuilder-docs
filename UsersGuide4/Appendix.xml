<?xml version="1.0"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
                 "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">

  <chapter id="Appendix">
    <title>Appendix</title>

    <para>This chapter provides additional information that may be useful 
    to Firewall Builder users.</para>

    <sect1 id="iptables_modules">
      <title>iptables modules</title>

      <sect2 id="iptables_install_ipset">
        <title>Installing the iptables ipset module</title>

        <para>
        Instructions for installing the iptables ipset module.
        </para>
        <sect3>
            <title>Installing ipset on Ubuntu Server 10.04 (Lucid Lynx)</title>
            <para>
            Instructions for installing the iptables ipset module on Ubuntu Server 10.04.
            </para>
            
            <para>
            First you need to get the ipset module source.  You can do this by running the
            commands shown below.  <emphasis>Note:</emphasis> you will need to be root or
            have sudo access to run these commands.  Depending on what is already installed on
            your system you might see slightly different command outputs.
            <programlisting>
fwbuilder@guardian:~$ sudo aptitude install ipset-source
Reading package lists... Done
Building dependency tree       
Reading state information... Done

            </programlisting>
            Depending on how many package dependencies need to be installed you will see a 
            bunch of install messages, the final messages should look something like:
            <programlisting>
Setting up build-essential (11.4build1) ...
Processing triggers for libc-bin ...
ldconfig deferred processing now taking place
fwbuilder@guardian:~$ 
            </programlisting>
            </para>

            <para>
            Next you will need to build the ipset module from source.  We use the convenient module-assistant for this.
            You will see a window pop-up that displays the status of the module being built.
            <programlisting>
fwbuilder@guardian:~$ sudo module-assistant build ipset
Extracting the package tarball, /usr/src/ipset.tar.bz2, please wait...
Done with /usr/src/ipset-modules-2.6.32-21-generic-pae_2.5.0-1
+2.6.32-21.32_i386.deb .
fwbuilder@guardian:~$ 
            </programlisting>
            </para>

            <para>
            Once this is complete you need to install the debian package that was created by module-assistant.
            <programlisting>
fwbuilder@guardian:~$ sudo dpkg -i \
/usr/src/ipset-modules-2.6.32-21-generic-pae_2.5.0-1+2.6.32-21.32_i386.deb

Selecting previously deselected package ipset-modules-2.6.32-21-generic-pae.
(Reading database ... 47485 files and directories currently installed.)
Unpacking ipset-modules-2.6.32-21-generic-pae 
(from .../ipset-modules-2.6.32-21-generic-pae_2.5.0-1+2.6.32-21.32_i386.deb) ...
Setting up ipset-modules-2.6.32-21-generic-pae (2.5.0-1+2.6.32-21.32) ...

fwbuilder@guardian:~$ 
            </programlisting>
            </para>

            <para>
            Now you need to install the ipset tools.
            <programlisting>
fwbuilder@guardian:~$ sudo aptitude install ipset
Reading package lists... Done
Building dependency tree       
Reading state information... Done
Reading extended state information      
Initializing package states... Done
The following NEW packages will be installed:
  ipset 
  0 packages upgraded, 1 newly installed, 0 to remove and 32 not upgraded.
  Need to get 0B/46.4kB of archives. After unpacking 233kB will be used.
  Writing extended state information... Done
  Selecting previously deselected package ipset.
  (Reading database ... 47460 files and directories currently installed.)
  Unpacking ipset (from .../ipset_2.5.0-1_i386.deb) ...
  Processing triggers for man-db ...
  Setting up ipset (2.5.0-1) ...
  Reading package lists... Done             
  Building dependency tree       
  Reading state information... Done
  Reading extended state information      
  Initializing package states... Done
  Writing extended state information... Done

fwbuilder@guardian:~$ 
        </programlisting>
        </para>

        <para>
        Your ipset module installation should now be complete.  To confirm that the installation was successful
        try running the following commands.
        <programlisting>
fwbuilder@guardian:~$ sudo ipset --version
ipset v2.5.0 Protocol version 2.
fwbuilder@guardian:~$ 
fwbuilder@guardian:~$ sudo ipset -N test iphash
fwbuilder@guardian:~$ 
fwbuilder@guardian:~$ sudo ipset --list
[sudo] password for fwbuilder: 
Name: test
Type: iphash
References: 0
Default binding: 
Header: hashsize: 1024 probes: 8 resize: 50
Members:
Bindings:

fwbuilder@guardian:~$ sudo ipset -X test
fwbuilder@guardian:~$ sudo ipset --list
        </programlisting>
        </para>


        </sect3>
      </sect2>

    </sect1>

  </chapter>
